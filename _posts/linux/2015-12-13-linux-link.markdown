---
layout: article
title:  "linux的软连接与硬链接"
date:   2015-12-13 09:20:00 +0800
categories: linux
---
# 介绍 #

软连接：即windows快捷方式，更改这个文件，链接文件也改变

硬链接：不能对文件夹/目录做硬链接，连接到同一个Inode，相当于同一个文件有多个文件名

## 创建方法都很简单 ##

软链接（符号链接） 
 
{% highlight bash %}
{% raw %}

ln -s   source  target 

{% endraw %}
{% endhighlight %}

硬链接 （实体链接）
 
{% highlight bash %}
{% raw %}

ln       source  target

{% endraw %}
{% endhighlight %}

----------

# inode #

要解释清楚两者的区别和联系需要先说清楚 linux 文件系统中的 inode 这个东西。当划分磁盘分区并格式化的时候，整个分区会被划分为两个部分，即inode区和data block(实际数据放置在数据区域中）这个inode即是（目录、档案）文件在一个文件系统中的唯一标识，需要访问这个文件的时候必须先找到并读取这个文件的 inode。 

Inode 里面存储了文件的很多重要参数，其中唯一标识称作 Inumber, 其他信息还有创建时间（ctime）、修改时间(mtime) 、文件大小、属主、归属的用户组、读写权限、数据所在block号等信息。

通常会根据分区的用途来安排inode的数量（这是另外一个话题了），比如文件数量很多而文件都很小，则需要调增inode较大，以便能索引全部文件。否则将会出现这个分区并没有写满而无法写入任何文件的情况。

## 目录文件与档案文件 ##

目录文件：记录该目录下的文件名

档案文件：记录实际文件数据

inode本身并不记录文件名，文件名记录在目录文件的block当中，所以新增、删除、更改文件名与目录的W权限有关。因此当我们要读某个档案时，就务必经过其目录的inode和block，然后才能够找到待读取档案的inode号，最终才会读到正确的档案block内的数据。系统是通过索引节点(而不是文件名)来定位每一个文件。

目录inode（满足权限？） => 目录block => 档案inode（满足权限？） => 档案block

## 下面用一个实例来说明硬链接和软链接。 ##

现在目录下有两个文件，一个名为AAA，一个名为BBB。

引用
 
{% highlight bash %}
{% raw %}

$ ls -il

963922 -rw-r–r– 1 ocean ocean 92 2007-05-18 15:46 AAA
963923 -rw-r–r– 1 ocean ocean 95 2007-05-18 15:46 BBB

{% endraw %}
{% endhighlight %}

首先先做一个AAA的硬链接。

引用
 
{% highlight bash %}
{% raw %}

$ ln AAA AAAhard

$ls -il

963922 -rw-r–r– 2 ocean ocean 92 2007-05-18 15:46 AAA
963922 -rw-r–r– 2 ocean ocean 92 2007-05-18 15:46 AAAhard
963923 -rw-r–r– 1 ocean ocean 95 2007-05-18 15:46 BBB

{% endraw %}
{% endhighlight %}

这里我们注意在创建链接前，AAA显示的链接数目为1，创建链接后

	1.AAA和AAAhard的链接数目都变为2。
	2.AAA和AAAhard的inode号是一样的，都是963922。
	3.AAA和AAAhard显示的文件大小也是一样，都是92B。

可见进行了ln命令的操作结果：AAA和AAAhard是同一个文件的两个名字，它们具有同样的索引节点号和文件属性，建立文件AAA的硬链接，就是为 AAA的文件索引节点在当前目录上建立一个新指针。你可以删除其中任何一个，如rm AAA，每次只会删除一个指针，链接数同时减一，只有将所有指向文件内容的指针，也即链接数减为0时，内核才会把文件内容从磁盘上删除。

尽管硬链接节省空间，也是Linux系统整合文件系统的传统方式，但是存在一些不足之处：

	1.不允许给目录创建硬链接。
	2.不可以在不同文件系统的文件间建立链接。因为 inode 是这个文件在当前分区中的索引值，是相对于这个分区的，当然不能跨越文件系统了。

接着我们做一个指向BBB的软链接，软链接克服了硬链接的不足，没有任何文件系统的限制，任何用户可以创建指向目录的符号链接。因而现在更为广泛使用，它具有更大的灵活性，甚至可以跨越不同机器、不同网络对文件进行链接。

引用
 
{% highlight bash %}
{% raw %}

$ ln -s BBB BBBsoft
$ ls -il

总用量 0
963922 -rw-r–r– 2 ocean ocean 92 2007-05-18 15:46 AAA
963922 -rw-r–r– 2 ocean ocean 92 2007-05-18 15:46 AAAhard
963923 -rw-r–r– 1 ocean ocean 95 2007-05-18 15:46 BBB
963924 lrwxrwxrwx 1 ocean ocean 3 2007-05-18 15:47 BBBsoft -> BBB

{% endraw %}
{% endhighlight %}

从上面链接后的结果可以看出来软链接与硬链接，区别不仅仅是在概念上，在实现上也是完全不同的。

区别：

	1.硬链接原文件/链接文件公用一个inode号，说明他们是同一个文件，而软链接原文件/链接文件拥有不同的inode号，表明他们是两个不同的文件；
	2.在文件属性上软链接明确写出了是链接文件，而硬链接没有写出来，因为在本质上硬链接文件和原文件是完全平等关系；
	3.链接数目是不一样的，软链接的链接数目不会增加；
	4.文件大小是不一样的，硬链接文件显示的大小是跟原文件是一样的。而这里软链接显示的大小与原文件就不同了，BBB大小是95B，而BBBsoft是3B。因为BBB共有3个字符
	5.软链接没有任何文件系统的限制，任何用户可以创建指向目录的符号链接

总之，建立软链接就是建立了一个新文件。当访问链接文件时，系统就会发现他是个链接文件，它读取链接文件找到真正要访问的文件。
当然软链接也有硬链接没有的缺点：因为链接文件包含有原文件的路径信息，所以当原文件从一个目录下移到其他目录中，再访问链接文件，系统就找不到了，而硬链接就没有这个缺陷，你想怎么移就怎么移；还有它要系统分配额外的空间用于建立新的索引节点和保存原文件的路径。